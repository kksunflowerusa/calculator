<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>台灣→美國 運費計算機</title>
<style>
  body {font-family: Arial,"Noto Sans TC",sans-serif; max-width:720px; margin:30px auto; padding:20px;}
  label {display:block; margin-top:12px;}
  input[type="number"], input[type="text"] {width:100%; padding:8px; font-size:16px; box-sizing:border-box;}
  button {margin-top:16px; padding:10px 18px; font-size:16px; border-radius:8px; cursor:pointer;}
  .result {margin-top:20px; padding:16px; border-radius:8px; background:#f7f7f7;}
  .error {color:#b00020;}
  .muted {color:#666; font-size:13px;}
</style>
</head>
<body>
<h2>台灣→美國 運費計算機</h2>

<!-- 尺寸與重量輸入 -->
<label>長度（公分）</label>
<input id="lenCm" type="number" step="0.1" min="0.1" placeholder="例如 40" />

<label>寬度（公分）</label>
<input id="widCm" type="number" step="0.1" min="0.1" placeholder="例如 30" />

<label>高度（公分）</label>
<input id="heiCm" type="number" step="0.1" min="0.1" placeholder="例如 20" />

<label>實際重量（公斤）</label>
<input id="kg" type="number" step="0.1" min="0.1" placeholder="例如 5" />

<label>美國收件 Zip code（5 位）</label>
<input id="zip" type="text" maxlength="5" placeholder="例如 92870" />

<button onclick="calcAll()">計算總運費</button>

<div class="muted">計費依磅 (lb) 計算；尺寸將自動換算成英吋並取整。</div>
<div id="output" class="result" style="display:none;"></div>

<script>
const API_URL = 'https://script.google.com/macros/s/你的部署ID/exec'; // ←換成實際 Apps Script 網址
const INTERNATIONAL_RATE = 3.99; // USD per lb
const SERVICE_FEE_THRESHOLD = 20; // lb
const SERVICE_FEE = 6; // USD

function show(msg, isErr=false){
  const out = document.getElementById('output');
  out.style.display='block';
  out.className = 'result' + (isErr?' error':'');
  out.innerHTML = msg;
}

function ceil(n){ return Math.ceil(Number(n)); }

function calcAll(){
  const len = Number(document.getElementById('lenCm').value);
  const wid = Number(document.getElementById('widCm').value);
  const hei = Number(document.getElementById('heiCm').value);
  const kg  = Number(document.getElementById('kg').value);
  const zip = document.getElementById('zip').value.trim();

  // 驗證
  if([len,wid,hei,kg].some(v=>!v || v<=0)){
    show('請輸入正確的長寬高與重量（皆需大於 0）。',true); return;
  }
  if(!zip || zip.replace(/\D/g,'').length!==5){
    show('請輸入 5 位數 Zip code。',true); return;
  }

  // ---- 1️⃣ 計算材積重與實際重量 ----
  const lIn = ceil(len/2.54);
  const wIn = ceil(wid/2.54);
  const hIn = ceil(hei/2.54);
  const volWeight = ceil((lIn * wIn * hIn)/139);
  const realWeight = ceil(kg / 0.454);
  const chargeWeight = Math.max(volWeight, realWeight);

  // 國際運費
  const intlFee = chargeWeight * INTERNATIONAL_RATE;

  // ---- 2️⃣ TW 服務費 ----
  const twFee = chargeWeight <= SERVICE_FEE_THRESHOLD ? SERVICE_FEE : 0;

  // ---- 3️⃣ 查詢美國國內運費 ----
  show('計算中…');

  fetch(`${API_URL}?zip=${encodeURIComponent(zip)}&weight=${chargeWeight}`)
    .then(r=>r.json())
    .then(resp=>{
      if(!resp.success){ show('國內運費錯誤：'+resp.message,true); return; }

      const usFee = Number(resp.rate);
      const total = intlFee + twFee + usFee;

      show(`
        <strong>計算結果</strong><br/>
        ──────────────<br/>
        材積重：${volWeight} lb<br/>
        實際重：${realWeight} lb<br/>
        <b>計費磅數：${chargeWeight} lb</b><br/><br/>
        1️⃣ 國際運費：$${intlFee.toFixed(2)}<br/>
        2️⃣ TW 服務費：$${twFee.toFixed(2)}<br/>
        3️⃣ 美國國內運費：$${usFee.toFixed(2)}<br/>
        ──────────────<br/>
        <b>總運費：$${total.toFixed(2)}</b>
      `);
    })
    .catch(err=>show('發生錯誤：'+err,true));
}
</script>
</body>
</html>
