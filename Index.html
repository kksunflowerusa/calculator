<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<base target="_top"> <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é›†é‹è¨‚å–®æŸ¥è©¢</title>
<style>
  body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; background: #f4f4f4; padding: 20px; }
  .container { max-width: 500px; margin: auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);}
  h2 { text-align:center; margin-bottom:20px; color:#333; }
  label { display:block; margin-top:10px; font-weight:bold; color:#555; }
  select, input { width:100%; padding:12px; margin-top:5px; border-radius:8px; border:1px solid #ccc; box-sizing: border-box; }
  button { width:100%; padding:12px; margin-top:15px; background:#2563eb; color:white; font-size:16px; border:none; border-radius:8px; cursor:pointer; transition: background 0.3s; }
  button:hover { background:#1e40af; }
  #resultBox { margin-top:20px; padding:15px; background:#eef2ff; border-left:4px solid #2563eb; display:none; white-space:pre-wrap; border-radius: 8px; }
  .error { background:#fee2e2; border-left-color:#dc2626; color:#dc2626; }
</style>
</head>
<body>
<div class="container">
  <h2>é›†é‹åˆ°è²¨æŸ¥è©¢2</h2>
  <label for="source">é¸æ“‡ä¾†æºè¡¨å–®</label>
  <select id="source">
    <option value="">è«‹é¸æ“‡</option>
    <option value="B3">B3</option>
    <option value="C2">C2</option>
    <option value="C2-DE">C2-DE</option>
  </select>

  <label for="orderNo">è¼¸å…¥è¨‚å–®è™Ÿç¢¼</label>
  <input type="text" id="orderNo" placeholder="è«‹è¼¸å…¥è¨‚å–®è™Ÿç¢¼">

  <button onclick="queryOrder()">æŸ¥è©¢</button>

  <div id="resultBox"></div>
</div>

<script>
/**
 * æˆåŠŸè™•ç† Apps Script å›å‚³çµæœçš„è™•ç†å‡½å¼
 * @param {object} data - å¾ Apps Script å‚³å›çš„ç‰©ä»¶ {status: ..., content: ...}
 */
function handleSuccess(data) {
  const resultBox = document.getElementById("resultBox");
  resultBox.style.display = "block";
  resultBox.classList.remove('error'); // æ¸…é™¤å¯èƒ½çš„éŒ¯èª¤æ¨£å¼

  if (data.status === "success") {
    resultBox.textContent = "âœ… æŸ¥è©¢çµæœï¼š\n" + data.content;
  } else {
    resultBox.textContent = "âŒ éŒ¯èª¤ï¼š" + data.message;
    resultBox.classList.add('error'); // æ·»åŠ éŒ¯èª¤æ¨£å¼
  }
}

/**
 * è™•ç† Apps Script åŸ·è¡Œå¤±æ•—æˆ–ç•°å¸¸çš„è™•ç†å‡½å¼
 * @param {Error} error - éŒ¯èª¤ç‰©ä»¶
 */
function handleFailure(error) {
  const resultBox = document.getElementById("resultBox");
  resultBox.style.display = "block";
  resultBox.classList.add('error');
  resultBox.textContent = "ğŸš¨ ç™¼ç”Ÿä¼ºæœå™¨éŒ¯èª¤ï¼š" + error.message;
}

/**
 * è§¸ç™¼æŸ¥è©¢çš„å‡½å¼
 */
function queryOrder() {
  const source = document.getElementById("source").value;
  const orderNo = document.getElementById("orderNo").value.trim();
  const resultBox = document.getElementById("resultBox");
  resultBox.style.display = "none"; // æŸ¥è©¢å‰éš±è—çµæœ

  if (!source) { 
    resultBox.textContent = "âš ï¸ è«‹é¸æ“‡ä¾†æºè¡¨å–®";
    resultBox.style.display = "block";
    resultBox.classList.add('error');
    return; 
  }
  if (!orderNo) { 
    resultBox.textContent = "âš ï¸ è«‹è¼¸å…¥è¨‚å–®è™Ÿç¢¼";
    resultBox.style.display = "block";
    resultBox.classList.add('error');
    return; 
  }

  // ç¦ç”¨æŒ‰éˆ•é˜²æ­¢é‡è¤‡æäº¤
  const button = document.querySelector('button');
  button.disabled = true;
  button.textContent = 'æŸ¥è©¢ä¸­...';

  // ä½¿ç”¨ google.script.run å‘¼å«ä¼ºæœå™¨ç«¯å‡½å¼
  google.script.run
    .withSuccessHandler(function(data) {
        handleSuccess(data);
        button.disabled = false;
        button.textContent = 'æŸ¥è©¢';
    })
    .withFailureHandler(function(error) {
        handleFailure(error);
        button.disabled = false;
        button.textContent = 'æŸ¥è©¢';
    })
    .queryOrderData(source, orderNo); // å‘¼å« Apps Script çš„ queryOrderData å‡½å¼
}
</script>
</body>
</html>

